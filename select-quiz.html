<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Category Quiz List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { background:linear-gradient(120deg,#260154,#241447 85%); color:#fff; font-family:'Poppins',sans-serif; margin:0; }
    .container { max-width:440px; margin:0 auto; background:rgba(30,0,60,0.21); border-radius:19px; box-shadow:0 0 19px #ff4dc4; padding:22px 15px; }
    h2 { text-align:center; color:#ff4dc4; font-family:'Ninja Naruto',cursive; margin-bottom:21px; }
    .quiz-list { margin-top:11px; }
    .quiz-card { background:rgba(40,1,60,0.25); border-radius:16px;border:2.5px solid #ff4dc4;margin-bottom:15px;padding:17px 0;text-align:center;}
    .quiz-title { font-size:19px; color:#ff77ff; font-weight:600; font-family:'Press Start 2P',cursive;}
    .quiz-btn { background:linear-gradient(90deg,#ff4dc4,#a449ff); color:#fff; font-weight:bold; border:none; border-radius:8px; margin-top:7px; padding:10px 23px; font-size:15px; cursor:pointer;}
    .quiz-btn:hover { background:linear-gradient(90deg,#a449ff,#ff4dc4);}
  </style>
</head>
<body>
  <div class="container">
    <h2 id="categoryHeading">Loading...</h2>
    <div class="quiz-list" id="quizList">
      <!-- Quiz cards will appear here -->
    </div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCw5PitKPzzRBWdlZiI-Csm-N3av_9lIqQ",
      authDomain: "anime001-d6669.firebaseapp.com",
      projectId: "anime001-d6669",
      storageBucket: "anime001-d6669.appspot.com",
      messagingSenderId: "1005431495919",
      appId: "1:1005431495919:web:dfbf43ba8a2a8ae5db4f1a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function getCategoryFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get('cat') || 'naruto';
    }
    const category = getCategoryFromURL();
    document.getElementById('categoryHeading').textContent = category.charAt(0).toUpperCase() + category.slice(1) + " Quizzes";

    async function loadQuizzes() {
      const quizListEl = document.getElementById('quizList');
      quizListEl.innerHTML = "<div>Loading...</div>";
      try {
        const subQuizSnap = await getDocs(collection(db,"quizzes",category,"subQuizzes"));
        if (subQuizSnap.empty) {
          quizListEl.innerHTML = `<div style="text-align:center;color:#ffabab;font-size:16px;">No quizzes found for ${category}.</div>`;
          return;
        }
        quizListEl.innerHTML = "";
        subQuizSnap.forEach(doc=>{
          const quizName = doc.id;
          const quizCard = document.createElement("div");
          quizCard.className = "quiz-card";
          quizCard.innerHTML = `
            <div class="quiz-title">${quizName}</div>
            <button class="quiz-btn" onclick="startQuiz('${quizName}')">Start Quiz</button>
          `;
          quizListEl.appendChild(quizCard);
        });
      } catch (e) {
        quizListEl.innerHTML = `<div style="color:red;">Error loading quizzes.</div>`;
      }
    }
    window.startQuiz = function(quizName) {
      // Redirect to actual quiz play page, passing category and quiz parameters
      window.location.href = `play-quiz.html?cat=${encodeURIComponent(category)}&quiz=${encodeURIComponent(quizName)}`;
    };

    loadQuizzes();
  </script>
</body>
</html>
