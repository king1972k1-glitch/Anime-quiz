<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Select Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { background: linear-gradient(120deg,#260154,#241447 85%); color: #fff; font-family: 'Poppins',sans-serif; margin:0;}
    .container { max-width:440px; margin:22px auto; background:rgba(30,0,60,0.21); border-radius:19px; box-shadow:0 0 19px #ff4dc4; padding:22px 15px;}
    h2 { text-align:center; color:#ff4dc4; font-family:'Ninja Naruto',cursive; margin-bottom:21px;}
    .quiz-list { margin-top:11px; }
    .quiz-card { background:rgba(40,1,60,0.25); border-radius:16px;border:2.5px solid #ff4dc4;margin-bottom:15px;padding:17px 0;text-align:center;}
    .quiz-title { font-size:19px; color:#ff77ff; font-weight:600; font-family:'Press Start 2P',cursive;}
    .quiz-btn { background:linear-gradient(90deg,#ff4dc4,#a449ff); color:#fff; font-weight:bold; border:none; border-radius:8px; margin-top:7px; padding:10px 23px; font-size:15px; cursor:pointer;}
    .quiz-btn:hover { background:linear-gradient(90deg,#a449ff,#ff4dc4);}
    #statusMsg {margin-top:18px;text-align:center;min-height:24px;font-size:15px;color:#ffb1ff;}
  </style>
</head>
<body>
  <div class="container">
    <h2 id="categoryHeading">Select Quiz</h2>
    <div id="statusMsg"></div>
    <div class="quiz-list" id="quizList"></div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCw5PitKPzzRBWdlZiI-Csm-N3av_9lIqQ",
      authDomain: "anime001-d6669.firebaseapp.com",
      projectId: "anime001-d6669",
      storageBucket: "anime001-d6669.appspot.com",
      messagingSenderId: "1005431495919",
      appId: "1:1005431495919:web:dfbf43ba8a2a8ae5db4f1a"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function getParam(key) {
      const params = new URLSearchParams(window.location.search);
      return params.get(key) || '';
    }
    const category = getParam('cat').toLowerCase();  // Always lowercase for consistency

    document.getElementById('categoryHeading').textContent =
      category ? category.charAt(0).toUpperCase() + category.slice(1) + ' Quizzes' : 'Select Quiz';

    async function loadQuizzes() {
      const quizListEl = document.getElementById('quizList');
      const statusMsg = document.getElementById('statusMsg');
      quizListEl.innerHTML = "";
      statusMsg.textContent = "";

      if (!category) {
        statusMsg.textContent = "No category selected!";
        return;
      }
      try {
        const subQuizSnap = await getDocs(collection(db, "quizzes", category, "subQuizzes"));
        if (subQuizSnap.empty) {
          statusMsg.textContent = `No quizzes found for "${category}".`;
          return;
        }
        subQuizSnap.forEach(doc => {
          const quizName = doc.id;
          const quizCard = document.createElement("div");
          quizCard.className = "quiz-card";
          quizCard.innerHTML = `
            <div class="quiz-title">${quizName}</div>
            <button class="quiz-btn" onclick="startQuiz('${quizName}')">Play Quiz</button>
          `;
          quizListEl.appendChild(quizCard);
        });
      } catch (e) {
        statusMsg.textContent = "Error loading quizzes!";
      }
    }
    // Secure page: define startQuiz globally
    window.startQuiz = function(quizName) {
      // Lowercase for consistency on path parameters
      window.location.href = `play-quiz.html?cat=${encodeURIComponent(category)}&quiz=${encodeURIComponent(quizName)}`;
    };

    loadQuizzes();
  </script>
</body>
</html>
